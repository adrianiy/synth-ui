import { Meta, Story } from '@storybook/addon-docs';
import { WithGlobalTheme } from '../helpers/decorators';

<Story name="Getting Started" decorators={[ WithGlobalTheme ]} />

<Meta title="Getting Started" parameters={{ viewMode: 'docs' }}/>

###### Glyph-React
# Getting Started

<Story name="Install" />

## Install

```bash
# yarn
yarn add glyph-react

# npm
npm i glyph-react
```

<Story name="React" />

## React

To use this React library you'll need to follow these simple steps:

-  Call setup method in main file.

```javascript
// main.js

import { setup } from 'glyph-react-poc';

setup();
```

-  Import main css folder to include css variables and style components

```css
# theme.css or main.css

@import "glyph-components/dist/glyph-components/glyph-components";
```

-  Execute `yarn build` script to copy assets in static folder

```bash
yarn build
```

-  Use glyph-components wherever you like to.

```javascript
import { GlyphReactList } from 'glyph-react-poc';

...

    return (
        <div className="App">
            <div className="list">
                <GlyphReactList title={'List'} limit={3} data={data} fieldsConfig={fieldsConfig} />
            </div>
        </div>
    );
...
```

<Story name="Amiga FWK"/>

### AMIGA-FWK

- Add `otf` font type support in webpack. Find the line where font-types are parsed and add `otf` at the end of the regex. It should look like this:

```javascript
            {
                test: /\.(woff|woff2|ttf|eot|svg|otf)(\?v=[0-9]\.[0-9]\.[0-9])?$/,
                exclude: /\.icon\.svg$/,
                use: {
                    loader: "file-loader?name=assets/fonts/[name].[ext]",
                },
            },
```



- Install `copy-webpack-plugin`.

```bash
yarn add copy-webpack-plugin
```

- Import assets dir from `node_modules/glyph_react/dist/assets` in your local assets.

```javascript
// amiga FWK (webpack 4)

const copyPlugin = require('copy-webpack-plugin');

...

    plugins: [
        new copyPlugin({
            patterns: [
                { from: projectPath('node_modules/glyph-react/dist/assets'), to: 'assets' }
            ]
        }),
        ...
    ]
...
```

- Execute `yarn build` in frontend folder

```bash
yarn build
```

-  Call setup method in main file.

> This allows React to use **custom elements**

```javascript
// main.js

import { setup } from 'glyph-react';

setup();
```

- To Style components you must use [StyleProvider](?path=/docs/react_providers-styles--styles-provide).

> Global variables cannot be imported in CSS files because amiga fwk minificates these values and shadowed components will not be styled.


- To use filters in your application you can use [Filters Provider](?path=/docs/react_providers-filters--filters).


- If your application uses a context-path probably you'll need to use `basePath` property in your components to fix local assets loading.

<Story name="Example"/>

## Example

This is an example of application using `glyph-react`.

<div class="warning">

> All application must be wrapped inside FiltersStateProvider to have access to filters state

</div>

```javascript
// home.js
import { FiltersConfig } from "../../utils/filters-config";
import { FilterStateProvider, GlyphStyleProvider, UIInterface, UITheme } from "glyph-react-poc";

const Home = () => {
    const entities = // fetch entities data...
    const glyphInterface = localStorage.getItem("drive.glyph-ui.interface") || UIInterface.redesign;
    const glyphTheme = localStorage.getItem("drive.glyph-ui.theme") || UITheme.light;

    return (
        <FilterStateProvider entities={entities} filtersConfig={FiltersConfig} screen="konnect">
            <GlyphStyleProvider interface={glyphInterface} theme={glyphTheme}>
                <Layout>
                    <Content />
                </Layout>
            </GlyphStyleProvider>
        </FilterStateProvider>
    );
};
```


```javascript
// layout.js 

import {
    Brands,
    GlyphHeader,
    GlyphReactChipsbar,
    UIInterface,
    useGlyphStyle,
} from "glyph-react";
import useLocale from "amiga-components-intl/use-locale";
import useIntl from "amiga-components-intl/use-intl";
import messages from "../../../config/locales";

const main = () => {
    const { glyphInterface, glyphTheme, setGlyphInterface, setGlyphTheme } = useGlyphStyle();
    const { currentLocale, setCurrentLocale } = useLocale();

    const languages = [
        {
            name: intl.formatMessage({ id: "base.lang.english" }),
            value: "en",
            active: currentLocale === "en",
        },
        {
            name: intl.formatMessage({ id: "base.lang.spanish" }),
            value: "es",
            active: currentLocale === "es",
        },
    ];
    const themes = [
        {
            name: intl.formatMessage({ id: "base.theme.light" }),
            value: "light",
            active: glyphTheme === "light",
        },
        {
            name: intl.formatMessage({ id: "base.theme.dark" }),
            value: "dark",
            active: glyphTheme === "dark",
        },
    ];

    const handleLangChange = ({ detail: { value } }) => {
        setCurrentLocale(value);
    };

    const handleThemeChange = ({ detail: { value } }) => {
        localStorage.setItem("drive.glyph-ui.theme", value);
        setGlyphTheme(value);
    };

    return (
        <>
            <GlyphHeader
                locale={currentLocale}
                brand
                basePath="/glyph-ui"
                appTitle="DRIVE"
                appSubtitle="WAREHOUSES"
                share
                menu
                avatar
                showBrands={false}
                brandList={[]}
                userData={user}
                appData={getVisibleScreens(user, menuQuery.data)}
                interface={glyphInterface}
                activeBrand={Brands.zara}
                className={classes.Layout_header}
                userMenuConfig={{
                    interface: glyphInterface,
                    languages,
                    themes,
                }}
                onLangChange={handleLangChange}
                onThemeChange={handleThemeChange}
                onLogout={logOut}
            />
            <GlyphReactChipsbar
                locale={currentLocale}
                i18n={messages[currentLocale]}
                basePath="/glyph-ui"
                uiInterface={glyphInterface}
            />
        </>
    );
}

```

<Story name="Local" />

## Local Development

Execute

```bash
yarn react start:docs
```

You'll have react docs available on port *6009*.

### Using demo playground

To use react playground correctly you'll need to simulate a real-world installation. In order to do this you'll nedd to link `peerDependencies` from *react-demo* to *glyph-react*.

Execute these commands

```bash
cd packages/react-demo/node_modules/react
yarn link
cd ../react-dom
yarn link
cd ../react-redux
yarn link
cd ../redux
yarn link
cd ../../../glyph-react
yarn link react react-dom react-redux redux
```

Now you can run the playground! Happy coding!

```bash
yarn react start
```

You'll have a react application running on port *3000*
