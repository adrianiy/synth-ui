import { Meta, Story } from '@storybook/addon-docs/blocks';
import { WithGlobalTheme } from '../helpers/decorators';

<Story name="Filters" decorators={[ WithGlobalTheme ]} />

<Meta
    title="Providers/Filters"
/>

# Filters Prvider
##### FilterProvider

A provider to allow use of filters state across your application.

This will keep an state of which filters are applied and which are not. Will also apply
some logic on selection like filter relations management *Section -> Product line*.

<Story name="Filter Provider" />

```typescript
// filtersConfig.tsx

export const FiltersConfig = {
    date: {
        description: "Fecha",
        minDate: new Date(year - 1, 1, 1),
        maxDate: tomorrow,
        key: "date",
        visible: true,
        dateRanges,
        comparableType: ComparableType.commercial,
        selected: [dateRanges[1]],
        compDates: [],
    },
    product: {
        description: "Producto",
        plural: "Productos",
        key: "cod_product",
        visible: true,
        selected: [],
        options: [],
    },
    section: {
        description: "Sección",
        plural: "Secciones",
        key: "cod_section",
        visible: true,
        selected: [],
        options: [],
    },
    campaign: {
        description: "Campaña",
        plural: "Campañas",
        key: "cod_campaign",
        visible: true,
        selected: [],
        options: [],
    },
    market: {
        description: "Mercado",
        plural: "Mercados",
        key: "cod_market",
        related: ["platform"],
        searchPlaceholder: "Busca Alovera, Corea ...",
        visible: true,
        selected: [],
        options: [],
    },
    platform: {
        description: "País",
        plural: "Paises",
        key: "cod_platform",
        searchPlaceholder: "Busca España, Francia ...",
        visible: true,
        selected: [],
        options: [],
    },
};
```

```typescript
// main.tsx

import { FilterStateProvider } from 'glyph-react';

...
    <FilterStateProvider>
        <Home/>
    </FilterStateProvider>
...
```

```typescript
// home.tsx
...

import { useDispatch } from "react-redux";
import { useServices } from "@/providers";
import { actions } from "glyph-react";
import { FiltersConfig } from "../../utils/filters-config";

const Home = () => {
    const { entities } = useServices();
    const dispatch = useDispatch();

    useEffect(() => {
        async function loadFilters() {
            dispatch(
                actions.filters.initialize(
                    await entities.fetchFilterEntities([{ key: "cod_brand", op: "in", value: [1, 16] }]),
                    "konnect",
                    FiltersConfig,
                    {},
                    (desc) => desc,
                ),
            );
        }
        loadFilters();
    }, [dispatch, entities]);

    return (
        ...
    );
};

export default Home;
```

# Custom hooks

<Story name="Custom hooks" />

We provide you with a set of custom hooks to use and modify filters state.

#### useFiltersConfig

This hook will return an object with these properties:

- **filtersConfig**: Object with latest filters configuration.
- **selectFilter**: Method to apply filter selection.
- **udpateFilter**: Method to apply filter update.
- **clearFitler**: Method to clear a filter by code.
- **clearAll**: Method to clear all filters.

```typescript
    import { useFiltersConfig } from 'glyph-react';

    ....
    const { filtersConfig, selectFilter } = useFiltersConfig();
    ....
```

#### useFilters 

This hook will return an object with these properties:

- **queryFilters**: Array with latest selected filters in format [ { key, op, value },... ]
- **queryParams**: Object of applied filters to use as query parameters  { startDate: ..., endDate: ..., product: .... }
- **compDates**: Array of comparable dates
- **comparableType**: comparable type of [ commercial, calendar, custom, ordinal ];

```typescript
    import { useFilters } from 'glyph-react';

    ....
    const { queryFilters, comparableType } = useFilters();
    ....
```

### Logic inheritance

All logic implementation will lay on *glyph-core* vanilla javascript functions.


