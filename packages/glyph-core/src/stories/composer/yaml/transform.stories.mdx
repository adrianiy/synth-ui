import { Meta, Story } from '@storybook/addon-docs';
import { WithGlobalTheme } from './../../helpers/decorators';

<Story name="Transform" decorators={[ WithGlobalTheme ]} />

<Meta title="Glyph pipes/Configuration/Transform" />

###### Configuration
# transform

Execute some kind of configured transformation on each `data` row.

## Keys

If you confirue keys parameter pipe will transform key to the configured value

```yaml
transform:
    keys:
        code: cod_country

# [{ code: 1 }] -> [{ cod_country: 1 }]
```

## Operations

You can configure a set of operations to be executed in order

- add: add some key to the row. you must configure a `value`
- match: select key that matches value to execute transformation over it
- exlude: all keys that does not match this value will execute transformation
- preserve: preserve current value of matching element
- delete: deletes matching keys

Modificators:

- key: modifies key value
- value: modifies value

#### Parameters

| NAME | TYPE | DESCRIPTION | DEFAULT VALUE|
|:-----|:-----:|:---------|------:|
|data|String|Key of `ctx.state` where data is stored | data |
|store|String|Key of `ctx.state` where data will be stored | data |
|operations|Operation[]|Array of operations|undefined|
|keys|{ [key]: string }|keys to modify|null|

### Example

You can use this pipe to add suffixes in value fields like:

```yaml
name: add suffix
transform:
    data: comparable
    keys:
        code: cod_country
    operations:
        - add: test
          value: 1
        - match: test
          value: (value) => value === 1
```

#### Set entity name

You can play with state and some auxiliar functions offered by this library to do advance data modifications.

This examples search a entity match in state and saves description in row's name property.

```typescript
import { configureComposer, getEntityName } from 'glyph-core-poc';

export const composerConfigMiddleware = configureComposer({
    baseUrl,
    auth,
    setCountryName: (key, row, ctx) => getEntityName(row[key], ctx.state.country, 'cod_country', row),
});
```

```yaml
name: add entity name
transform:
    operations:
        - add: name
          value: setCountryName
```


#### Set growths

To set calculated fields like growths you can use aux methods like `getGrowth` or your custom methods

```typescript
import { configureComposer, getGrowh } from 'glyph-core-poc';

export const composerConfigMiddleware = configureComposer({
    baseUrl,
    auth,
    setGrowth: getGrowth('_comp'),
    setA2Growth: getGrowth('_a2'),
});

```

```yaml
name: set growths
transform:
    operations:
        - match: units|amount|orders
          exclude: comp|a2
          preserve: true
          key: key => `growth_${key}`
          value: setGrowth

