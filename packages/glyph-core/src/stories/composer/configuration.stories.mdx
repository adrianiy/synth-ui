import { Meta, Story } from '@storybook/addon-docs';
import { WithGlobalTheme } from './../helpers/decorators';

<Story name="YAML" decorators={[ WithGlobalTheme ]} />

<Meta title="Glyph pipes/Configuration/YAML" />


###### Configuration
# YAML

These are all available properties to configure your **yaml** file.

##### Context
- [Name](?path=/docs/composer-yaml-name--page)
- [Variables](?path=/docs/composer-yaml-variables--page)

##### Basic
- [Pipe](?path=/docs/composer-yaml-pipe--page)
- [Log](?path=/docs/composer-yaml-pipe--page)
- [Filters](?path=/docs/composer-yaml-filters--page)
- [Custom](?path=/docs/composer-yaml-custom--page)

##### Async
- [Fetch](?path=/docs/composer-yaml-fetch--page)
- [Parallel](?path=/docs/composer-yaml-parallel--page)

##### Data processing
- [Group](?path=/docs/composer-yaml-group--page)
- [Join](?path=/docs/composer-yaml-join--page)
- [Transform](?path=/docs/composer-yaml-transform--page)
- [Sort](?path=/docs/composer-yaml-sort--page)
- [Filter](?path=/docs/composer-yaml-filter--page)

## Variables

YAML variables are interpreted using this order:

- Values stored in `ctx.state` or `params` passed as second parameter in composer.
    - you can use a nested object key using `.` separators. I.E: `parameters.brands` will get brand value from { paramters: { brands: "1,16" } }
- String function to `eval()`.
- Primitive types like string, boolean, etc.

You can use this prefixes to force some variable to be interpreted as a specific type:

- **?$** VALUE IN CTX.STATE or PARAMS
- **?>** FUNCTION
- **?#** CONSTANT

## Example

This is an example of a configuration file to get sales by country.

<div class="warning">

> We recommend to **organize everything under a pipe** middleware to ensure execution's order

</div>

```yaml
name: Sales by hour
pipe:
  - filters:
      use:
        - local_date
        - cod_warehouse
        - cod_country

  # fetch hours
  - fetch:
      url: endpoints.hour

  # add hour to date
  - transform:
      operations:
        - match: local_date
          value: (date, row) => `${date} ${row.hour}`
```
